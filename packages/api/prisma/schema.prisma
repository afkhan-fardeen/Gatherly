generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String    @id @default(uuid())
  email             String    @unique
  phone             String?   @unique
  passwordHash      String    @map("password_hash")
  name              String
  role              String    @default("consumer")
  status            String    @default("active")
  profilePictureUrl String?   @map("profile_picture_url")
  defaultLocation   String?   @map("default_location")
  emailVerified     Boolean   @default(false) @map("email_verified")
  phoneVerified     Boolean   @default(false) @map("phone_verified")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  vendor    Vendor?
  events    Event[]
  bookings  Booking[]
  reviews   Review[]
  notifications Notification[]
  paymentMethods PaymentMethod[]

  @@map("users")
}

model PaymentMethod {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  last4     String   @map("last4")
  brand     String
  createdAt DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("payment_methods")
}

model Vendor {
  id               String   @id @default(uuid())
  userId           String   @unique @map("user_id")
  businessName     String   @map("business_name")
  businessType     String?  @map("business_type")
  ownerName        String?  @map("owner_name")
  description      String?
  cuisineTypes     String[] @map("cuisine_types")
  yearsInBusiness  Int?     @map("years_in_business")
  serviceAreas     String[] @map("service_areas")
  physicalAddress  String?  @map("physical_address")
  logoUrl          String?  @map("logo_url")
  featuredImageUrl String?  @map("featured_image_url")
  status           String   @default("pending")
  ratingAvg        Decimal  @default(0) @map("rating_avg") @db.Decimal(3, 2)
  ratingCount      Int      @default(0) @map("rating_count")
  totalBookings    Int      @default(0) @map("total_bookings")
  operatingHours   Json?    @map("operating_hours")
  availability     Json?    @map("availability")
  bankDetails      Json?    @map("bank_details")
  documents        Json?    @map("documents")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  packages Package[]
  bookings Booking[]
  reviews  Review[]

  @@map("vendors")
}

model Package {
  id                 String   @id @default(uuid())
  vendorId           String   @map("vendor_id")
  name               String
  description        String?
  packageType        String?  @map("package_type")
  priceType          String   @map("price_type")
  basePrice          Decimal  @map("base_price") @db.Decimal(10, 2)
  minGuests          Int?     @map("min_guests")
  maxGuests          Int?     @map("max_guests")
  setupFee           Decimal  @default(0) @map("setup_fee") @db.Decimal(10, 2)
  serviceChargePercent Decimal @default(0) @map("service_charge_percent") @db.Decimal(5, 2)
  imageUrl           String?  @map("image_url")
  isSpotlight        Boolean  @default(false) @map("is_spotlight")
  spotlightOrder     Int?     @map("spotlight_order")
  dietaryTags        String[] @map("dietary_tags")
  isActive           Boolean  @default(true) @map("is_active")
  displayOrder       Int      @default(0) @map("display_order")
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  vendor        Vendor         @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  packageItems  PackageItem[]
  bookings      Booking[]

  @@map("packages")
}

model PackageItem {
  id              String   @id @default(uuid())
  packageId       String   @map("package_id")
  name            String
  description     String?
  category        String?
  dietaryTags     String[] @map("dietary_tags")
  allergenWarnings String[] @map("allergen_warnings")
  imageUrl        String?  @map("image_url")
  displayOrder    Int      @default(0) @map("display_order")
  createdAt       DateTime @default(now()) @map("created_at")

  package Package @relation(fields: [packageId], references: [id], onDelete: Cascade)

  @@map("package_items")
}

model Event {
  id                  String   @id @default(uuid())
  userId              String   @map("user_id")
  name                String
  eventType           String   @map("event_type")
  date                DateTime @db.Date
  timeStart           DateTime? @map("time_start") @db.Time
  timeEnd             DateTime? @map("time_end") @db.Time
  guestCount          Int      @map("guest_count")
  location            String
  venueType           String?  @map("venue_type")
  venueName           String?  @map("venue_name")
  budgetMin           Decimal? @map("budget_min") @db.Decimal(10, 2)
  budgetMax           Decimal? @map("budget_max") @db.Decimal(10, 2)
  specialRequirements String?  @map("special_requirements")
  dietaryRequirements String[] @map("dietary_requirements")
  imageUrl            String?  @map("image_url")
  status              String   @default("draft")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  guests  Guest[]
  bookings Booking[]

  @@map("events")
}

model Guest {
  id               String   @id @default(uuid())
  eventId          String   @map("event_id")
  name             String
  email            String?
  phone            String?
  category         String?
  dietaryPreferences String[] @map("dietary_preferences")
  rsvpStatus       String   @default("pending") @map("rsvp_status")
  plusOneAllowed   Boolean  @default(false) @map("plus_one_allowed")
  notes            String?
  createdAt        DateTime @default(now()) @map("created_at")

  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@map("guests")
}

model Booking {
  id                 String   @id @default(uuid())
  bookingReference   String   @unique @map("booking_reference")
  userId             String   @map("user_id")
  vendorId           String   @map("vendor_id")
  eventId            String   @map("event_id")
  packageId          String   @map("package_id")
  guestCount         Int      @map("guest_count")
  status             String   @default("pending")
  paymentStatus      String   @default("unpaid") @map("payment_status")
  paymentMethod      String?  @map("payment_method")
  subtotal           Decimal  @map("subtotal") @db.Decimal(10, 2)
  serviceCharges     Decimal  @default(0) @map("service_charges") @db.Decimal(10, 2)
  totalAmount        Decimal  @map("total_amount") @db.Decimal(10, 2)
  specialRequirements String? @map("special_requirements")
  vendorNotes        String?  @map("vendor_notes")
  cancellationReason String?  @map("cancellation_reason")
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  user    User    @relation(fields: [userId], references: [id])
  vendor  Vendor  @relation(fields: [vendorId], references: [id])
  event   Event   @relation(fields: [eventId], references: [id])
  package Package @relation(fields: [packageId], references: [id])
  reviews Review[]

  @@map("bookings")
}

model Review {
  id               String   @id @default(uuid())
  bookingId        String   @unique @map("booking_id")
  vendorId         String   @map("vendor_id")
  userId           String   @map("user_id")
  ratingOverall    Int      @map("rating_overall")
  ratingFood       Int?     @map("rating_food")
  ratingService    Int?     @map("rating_service")
  ratingValue      Int?     @map("rating_value")
  reviewText       String?  @map("review_text")
  wouldRecommend   Boolean? @map("would_recommend")
  status           String   @default("published")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  booking Booking @relation(fields: [bookingId], references: [id])
  vendor  Vendor  @relation(fields: [vendorId], references: [id])
  user    User    @relation(fields: [userId], references: [id])

  @@map("reviews")
}

model Notification {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  type      String
  title     String
  message   String
  link      String?
  isRead    Boolean  @default(false) @map("is_read")
  metadata  Json?    @map("metadata")
  createdAt DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}
